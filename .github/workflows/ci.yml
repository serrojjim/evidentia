on:
  push:
    branches:
      - pruebas_actions
  pull_request:

name: CI
jobs:
  
  deploy:
    name: Deploy challenge
    runs-on: ubuntu-latest
    
    steps:
    
 
    - name: Cancel Previous Runs
      uses: styfle/cancel-workflow-action@0.8.0
      with:
        access_token: ${{ github.token }}
        
    - name: Checkout
      uses: actions/checkout@v2
      
    - name: Instalando laradock y lanzando container
      working-directory: /home/runner/work/evidentia/evidentia/
      run: |
        chmod +x install_laradock.sh
        sh install_laradock.sh
        cd laradock
        docker-compose up -d nginx mysql phpmyadmin redis workspace   
        
    - name: Dando permisos
      working-directory: /home/runner/work/evidentia/evidentia/
      run: |
        cd laradock
        docker exec --tty laradock_php-fpm bash
        chown -R www-data:www-data /var/www/storage
        
    - name: Lanzando en ngrok 
      uses: serrojjim/ngrok-tunneling-action@v0.1.6
      with:
        port: 80
        ngrok_authtoken: ${{ secrets.NGROK_AUTHTOKEN }}
  
